(function(){var e={activate:function(a,c){a=$(a);c=c?a.find(c):a.find(".dnd-trigger").length?a.find(".dnd-trigger"):a;a.data("dndsortclone",a.clone());c.css("cursor","move");$(a).addClass("dndsortactive");c.off("mousedown").on("mousedown",function(a){var b=$(this).is(".dndsortactive")?$(this):$(this).parents(".dndsortactive").get(0),c=$(this).parents(".dnd-grid").first(),d=a.pageY,f=a.pageX;a=$(b).offset();var k=$(window).scrollTop(),l=$(window).scrollLeft(),n=a.top-d-k,p=a.left-f-l,d=$(b).width(),
f=$(b).height(),m=$($(b).data("dndsortclone"));$(b).addClass("dndobject").css("opacity",0);var q=$(b).outerWidth()||$(b).width(),b=$($(b).parent()).outerWidth()||$($(b).parent()).width(),r=.8<q/b;m.css({top:a.top-k+"px",left:a.left-l+"px","z-index":200,position:"fixed",width:d,height:f,opacity:".8"}).addClass("dndclonedragged").removeClass("dndsortactive");$("body").append(m);e.posdim($(this).parent());$("body").off("mousemove.dndgrid").on("mousemove.dndgrid",function(a){var b=a.pageY;a=a.pageX;var f=
$(".dndclonedragged"),d=$(".dndobject");f.css({top:b+n+"px",left:a+p+"px"});$(".intersected").removeClass("intersected");b=e.check(f,r,c);b.left&&!b.left.is(d)?(b.left.before(d),setTimeout(function(){d.addClass("dnd-shown")},200)):b.right&&!b.right.is(d)&&b.right.after(d)}).off("mouseup.dndgrid").on("mouseup.dndgrid",function(){var b=$(".dndclonedragged"),a=$(".dndobject");e.off();a.removeClass("dndobject");var f=a.attr("style").replace(/opacity(\s+|)\:(\s+|)0(\;|)/,"");a.attr("style",f);b.detach();
a.trigger("dropped")});return!1})},off:function(a){$("body").unbind("mouseup.dndgrid").unbind("mousemove.dndgrid")},check:function(a,c,h){h=$(h).find(".dndsortactive").removeClass("intersected");var b=e.posdim(a),g=!1,d=!1;h.each(function(){var a=e.posdim($(this));c?(b.top>=a.top&&b.top<a.bottom-20&&(g=$(this).addClass("intersected")),b.top<=a.top&&b.bottom>a.top+20&&(d=$(this).addClass("intersected"))):(b.left<a.left&&b.right>a.left&&b.top>=a.top&&b.top<a.bottom-20?g=$(this).addClass("intersected"):
b.left<a.left&&b.right>a.left&&b.top<=a.top&&b.bottom>a.top+20&&(g=$(this).addClass("intersected")),b.left>a.left&&b.left<a.right&&b.top>=a.top&&b.top<a.bottom-20?d=$(this).addClass("intersected"):b.left>a.left&&b.left<a.right&&b.top<=a.top&&b.bottom>a.top+20&&(d=$(this).addClass("intersected")));if(g||d)return!1});return{right:d,left:g}},posdim:function(a){var c=a.offset(),e=a.outerWidth()||a.width();a=a.outerHeight()||a.height();c.bottom=c.top+a;c.right=c.left+e;c.height=a;c.width=e;return c}};
$.fn.dndgrid=function(a){var c=!1;a&&(c="undefined"==typeof a.trigger?!1:a.trigger);return this.each(function(){if($(this).data("dndgrid"))return!0;ori.addClass("dnd-placed");$(this).data("dndgrid",!0);e.activate($(this),c)})};$(function(){$(".dnd-grid .dnd-gridcell").dndgrid()})})();
(function(){var e={activate:function(a,c){a=$(a);c=c?a.find(c):a.find(".dnd-trigger").length?a.find(".dnd-trigger"):a;a.data("dndsortclone",a.clone());c.css("cursor","move");$(a).addClass("dndsortactive");c.off("mousedown").on("mousedown",function(a){var b=$(this).is(".dndsortactive")?$(this):$(this).parents(".dndsortactive").get(0),c=$(this).parents(".dnd-grid").first(),d=a.pageY,f=a.pageX;a=$(b).offset();var k=$(window).scrollTop(),l=$(window).scrollLeft(),n=a.top-d-k,p=a.left-f-l,d=$(b).width(),
f=$(b).height(),m=$($(b).data("dndsortclone"));$(b).addClass("dndobject").css("opacity",0);var q=$(b).outerWidth()||$(b).width(),b=$($(b).parent()).outerWidth()||$($(b).parent()).width(),r=.8<q/b;m.css({top:a.top-k+"px",left:a.left-l+"px","z-index":200,position:"fixed",width:d,height:f,opacity:".8"}).addClass("dndclonedragged").removeClass("dndsortactive");$("body").append(m);e.posdim($(this).parent());$("body").off("mousemove.dndgrid").on("mousemove.dndgrid",function(a){var b=a.pageY,f=a.pageX,d=
$(".dndclonedragged");a=$(".dndobject");d.css({top:b+n+"px",left:f+p+"px"});$(".intersected").removeClass("intersected");b=e.check(d,r,c);!b.left||b.left.is(a)||b.left.prev().is(a)?!b.right||b.right.is(a)||b.right.next().is(a)||(b.right.after(a),a.trigger("placed")):(b.left.before(a),a.trigger("placed"))}).off("mouseup.dndgrid").on("mouseup.dndgrid",function(){var a=$(".dndclonedragged"),b=$(".dndobject");e.off();b.removeClass("dndobject");var f=b.attr("style").replace(/opacity(\s+|)\:(\s+|)0(\;|)/,
"");b.attr("style",f);a.detach();b.trigger("dropped")});return!1})},off:function(a){$("body").unbind("mouseup.dndgrid").unbind("mousemove.dndgrid")},check:function(a,c,h){h=$(h).find(".dndsortactive").removeClass("intersected");var b=e.posdim(a),g=!1,d=!1;h.each(function(){var a=e.posdim($(this));c?(b.top>=a.top&&b.top<a.bottom-20&&(g=$(this).addClass("intersected")),b.top<=a.top&&b.bottom>a.top+20&&(d=$(this).addClass("intersected"))):(b.left<a.left&&b.right>a.left&&b.top>=a.top&&b.top<a.bottom-
20?g=$(this).addClass("intersected"):b.left<a.left&&b.right>a.left&&b.top<=a.top&&b.bottom>a.top+20&&(g=$(this).addClass("intersected")),b.left>a.left&&b.left<a.right&&b.top>=a.top&&b.top<a.bottom-20?d=$(this).addClass("intersected"):b.left>a.left&&b.left<a.right&&b.top<=a.top&&b.bottom>a.top+20&&(d=$(this).addClass("intersected")));if(g||d)return!1});return{right:d,left:g}},posdim:function(a){var c=a.offset(),e=a.outerWidth()||a.width();a=a.outerHeight()||a.height();c.bottom=c.top+a;c.right=c.left+
e;c.height=a;c.width=e;return c}};$.fn.dndgrid=function(a){var c=!1;a&&(c="undefined"==typeof a.trigger?!1:a.trigger);return this.each(function(){if($(this).data("dndgrid"))return!0;$(this).data("dndgrid",!0);e.activate($(this),c)})};$(function(){$(".dnd-grid .dnd-gridcell").dndgrid()})})();
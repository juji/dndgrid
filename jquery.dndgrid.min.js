(function(){var e={activate:function(a,c){a=$(a);c=c?$(c,a):$(".dnd-trigger",a).length?$(".dnd-trigger",a):a;a.data("dndsortclone",a.clone());c.css("cursor","move");$(a).addClass("dndsortactive");c.on("mousedown",function(a){var b=$(this).is('.dndsortactive')?$(this):$(this).parents('.dndsortactive').get(0),c=a.pageY,d=a.pageX;a=$(b).offset();var g=$(window).scrollTop(),h=$(window).scrollLeft(),m=a.top-c-g,n=a.left-d-h,c=$(b).width(),d=$(b).height(),k=$($(b).data("dndsortclone"));$(b).addClass("dndobject").css("opacity",0);var p=$(b).outerWidth()||
$(b).width(),b=$($(b).parent()).outerWidth()||$($(b).parent()).width(),q=.8<p/b;k.css({top:a.top-g+"px",left:a.left-h+"px",'z-index':200,position:"fixed",width:c,height:d,opacity:".8"}).addClass("dndclonedragged");$("body").append(k);e.posdim($(this).parent());$("body").on("mousemove",function(a){var b=a.pageY,g=a.pageX,c=$(".dndclonedragged");a=$(".dndobject");c.css({top:b+m+"px",left:g+n+"px"});$(".intersected").removeClass("intersected");b=e.check(c,q);b.left&&!b.left.is(a)?b.left.before(a):b.right&&!b.right.is(a)&&
b.right.after(a)}).on("mouseup",function(){var a=$(".dndclonedragged"),b=$(".dndobject");e.off();b.removeClass("dndobject");var c=b.attr("style").replace(/opacity(\s+|)\:(\s+|)0(\;|)/,"");b.attr("style",c);a.detach();b.trigger("dropped")});return!1})},off:function(a){$("body").unbind("mouseup").unbind("mousemove")},check:function(a,c){var l=$(".dndsortactive").removeClass("intersected"),b=e.posdim(a),f=!1,d=!1;l.each(function(){var a=e.posdim($(this));c?(b.top>=a.top&&b.top<a.bottom-20&&(f=$(this).addClass("intersected")),
b.top<=a.top&&b.bottom>a.top+20&&(d=$(this).addClass("intersected"))):(b.left<a.left&&b.right>a.left&&b.top>=a.top&&b.top<a.bottom-20?f=$(this).addClass("intersected"):b.left<a.left&&b.right>a.left&&b.top<=a.top&&b.bottom>a.top+20&&(f=$(this).addClass("intersected")),b.left>a.left&&b.left<a.right&&b.top>=a.top&&b.top<a.bottom-20?d=$(this).addClass("intersected"):b.left>a.left&&b.left<a.right&&b.top<=a.top&&b.bottom>a.top+20&&(d=$(this).addClass("intersected")));if(f||d)return!1});return{right:d,left:f}},
posdim:function(a){var c=a.offset(),e=a.outerWidth()||a.width();a=a.outerHeight()||a.height();c.bottom=c.top+a;c.right=c.left+e;c.height=a;c.width=e;return c}};$.fn.dndgrid=function(a){var c=!1;a&&(c="undefined"==typeof a.trigger?!1:a.trigger);return this.each(function(){if($(this).data("dndgrid"))return!0;$(this).data("dndgrid",!0);e.activate($(this),c)})};$(function(){$(".dnd-grid .dnd-gridcell").dndgrid()})})();